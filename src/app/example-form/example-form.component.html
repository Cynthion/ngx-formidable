<!-- Control Center -->
<div class="control-center debug-output">
  <div class="control-toggle debug-toggle">
    <button (click)="toggleControlCenter()">
      {{ controlCenterExpanded ? 'Hide Control Center' : 'Show Control Center' }}
    </button>
  </div>

  <div
    *ngIf="controlCenterExpanded"
    class="control-body">
    <div class="control-content">
      <label>
        <input
          type="checkbox"
          [checked]="controlCenter.showPrefixes"
          (change)="controlCenter.showPrefixes = $any($event.target).checked" />
        Show Prefixes
      </label>

      <label>
        <input
          type="checkbox"
          [checked]="controlCenter.showSuffixes"
          (change)="controlCenter.showSuffixes = $any($event.target).checked" />
        Show Suffixes
      </label>

      <label>
        <input
          type="checkbox"
          [checked]="controlCenter.showTooltips"
          (change)="controlCenter.showTooltips = $any($event.target).checked" />
        Show Tooltips
      </label>

      <label>
        <input
          type="checkbox"
          [checked]="controlCenter.showLabels"
          (change)="controlCenter.showLabels = $any($event.target).checked" />
        Show Labels
      </label>

      <label>
        <input
          type="checkbox"
          [checked]="controlCenter.floatingLabels"
          (change)="controlCenter.floatingLabels = $any($event.target).checked" />
        Floating Labels
      </label>
    </div>
  </div>
</div>

<form
  formidableRootValidate
  formidableForm
  class="form"
  [validationOptions]="validationOptions"
  [formValue]="formValue$ | async"
  [formFrame]="formFrame"
  [suite]="suite"
  (dirtyChange$)="isDirty$.next($event)"
  (validChange$)="isValid$.next($event)"
  (errorsChange$)="errors$.next($event)"
  (formValueChange$)="formValue$.next($event)"
  (ngSubmit)="onSubmit()">
  <fieldset>
    @if (viewModel$ | async; as vm) {
      <!-- First Name -->
      <formidable-field-decorator>
        <formidable-input-field
          formidableFieldErrors
          placeholder="Your first name"
          autocomplete="given-name"
          name="firstName"
          [disabled]="false"
          [readonly]="false"
          [maxLength]="150"
          [ngModel]="vm.formValue$.firstName"
          (valueChanged)="onValueChanged('firstName', $event)"
          (focusChanged)="onFocusChanged('firstName', $event)">
        </formidable-input-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          First Name
        </div>
        <div formidableFieldTooltip>
          <example-tooltip
            placement="right"
            trigger="hover"
            [text]="'This is a input field. It has a tooltip.'">
          </example-tooltip>
        </div>
      </formidable-field-decorator>

      <!-- Middle Name -->
      <formidable-field-decorator>
        <formidable-input-field
          formidableFieldErrors
          placeholder="Your middle name"
          name="middleName"
          [disabled]="false"
          [readonly]="false"
          [minLength]="15"
          [maxLength]="15"
          [mask]="'AAA AAA AAA AAA'"
          [ngModel]="vm.formValue$.middleName"
          (valueChanged)="onValueChanged('middleName', $event)"
          (focusChanged)="onFocusChanged('middleName', $event)">
        </formidable-input-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Middle Name
        </div>
        <div formidableFieldTooltip>
          <example-tooltip
            placement="right"
            trigger="hover"
            [text]="'Fields can be masked, and have prefixes and suffixes.'">
          </example-tooltip>
        </div>
        <div formidableFieldPrefix>Prefix</div>
        <div formidableFieldSuffix>Suffix</div>
      </formidable-field-decorator>

      <!-- Last Name -->
      <formidable-field-decorator>
        <formidable-textarea-field
          formidableFieldErrors
          placeholder="Your last name"
          autocomplete="family-name"
          name="lastName"
          [disabled]="false"
          [readonly]="false"
          [enableAutosize]="true"
          [showLengthIndicator]="true"
          [maxLength]="300"
          [mask]="'AAA 000'"
          [maskConfig]="{ showMaskTyped: true }"
          [ngModel]="vm.formValue$.lastName"
          (valueChanged)="onValueChanged('lastName', $event)"
          (focusChanged)="onFocusChanged('lastName', $event)">
        </formidable-textarea-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Last Name
        </div>
        <div formidableFieldTooltip>
          <example-tooltip
            placement="bottom"
            trigger="click"
            [text]="'It opens on click. Below.'">
          </example-tooltip>
        </div>
      </formidable-field-decorator>

      <!-- Gender -->
      <formidable-field-decorator>
        <formidable-select-field
          formidableFieldErrors
          placeholder="Select..."
          name="gender"
          [disabled]="false"
          [readonly]="false"
          [ngModel]="vm.formValue$.gender"
          [options]="genderOptions"
          [sortFn]="sortAlphabetically"
          (valueChanged)="onValueChanged('gender', $event)"
          (focusChanged)="onFocusChanged('gender', $event)">
          <formidable-field-option
            [value]="'other'"
            [label]="'Other'"
            [disabled]="true" />
          <formidable-field-option [value]="'trans'">Trans</formidable-field-option>
        </formidable-select-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Gender
        </div>
        <div formidableFieldTooltip>
          <example-tooltip
            placement="right"
            trigger="click"
            [icon]="exampleTooltipSvg"
            [text]="'This is a select field. And this tooltip has another content.'">
          </example-tooltip>
        </div>
      </formidable-field-decorator>

      <!-- Nationality -->
      <formidable-field-decorator>
        <formidable-dropdown-field
          formidableFieldErrors
          placeholder="Select..."
          name="nationality"
          [disabled]="false"
          [readonly]="false"
          [ngModel]="vm.formValue$.nationality"
          [options]="nationalityOptions"
          [emptyOption]="nationalityEmptyOption"
          [panelPosition]="'left'"
          [sortFn]="sortAlphabetically"
          (valueChanged)="onValueChanged('nationality', $event)"
          (focusChanged)="onFocusChanged('nationality', $event)">
          <formidable-field-option
            [value]="'ch'"
            [label]="'CH'"
            >ðŸ‡¨ðŸ‡­ Switzerland (other label)</formidable-field-option
          >
          <formidable-field-option [value]="'it (no label)'">ðŸ‡®ðŸ‡¹ Italia (no label)</formidable-field-option>
          <formidable-field-option
            [value]="'custom'"
            [label]="'The Special One'">
            <p>I'm a special item</p>
            <pre>And I can have any content</pre>
          </formidable-field-option>
        </formidable-dropdown-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Nationality
        </div>
      </formidable-field-decorator>

      <!-- Hobby -->
      <formidable-field-decorator>
        <formidable-autocomplete-field
          formidableFieldErrors
          placeholder="Select..."
          name="hobby"
          [ngModel]="vm.formValue$.hobby"
          [disabled]="false"
          [readonly]="false"
          [options]="hobbyOptions"
          [emptyOption]="hobbyEmptyOption"
          [sortFn]="sortAlphabetically"
          (valueChanged)="onValueChanged('hobby', $event)"
          (focusChanged)="onFocusChanged('hobby', $event)">
          <formidable-field-option
            [value]="'garden'"
            [label]="'Gardening'"
            [disabled]="true">
            Gardening
          </formidable-field-option>
          <formidable-field-option
            [value]="'singing'"
            [label]="'SING'"
            >Singing (other label)</formidable-field-option
          >
          <formidable-field-option [value]="'other'">Other (no label)</formidable-field-option>
          <formidable-field-option
            [value]="'custom'"
            [label]="'The Special One'"
            [match]="specialMatchFn">
            <p>I'm a special item</p>
            <pre>And I can have any content</pre>
          </formidable-field-option>
        </formidable-autocomplete-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Hobby
        </div>
        <div formidableFieldTooltip>(Autocomplete)</div>
      </formidable-field-decorator>

      <!-- Animals -->
      <formidable-field-decorator>
        <formidable-autocomplete-field
          formidableFieldErrors
          placeholder="Select..."
          name="animal"
          [disabled]="false"
          [readonly]="false"
          [ngModel]="vm.formValue$.animal"
          [options]="animalOptionsDefault"
          [emptyOption]="animalEmptyOption"
          (valueChanged)="onValueChanged('animal', $event)"
          (focusChanged)="onFocusChanged('animal', $event)"
          (filterChanged)="onAnimalFilterChange($event)">
          @for (option of animalOptionsFiltered$ | async; track option.value) {
            <example-fuzzy-option
              [value]="option.value"
              [label]="option.label"
              [disabled]="option.disabled || false"
              [subtitle]="option.subtitle"
              [highlightedEntries]="option.highlightedEntries || { labelEntries: [], subtitleEntries: [] }">
            </example-fuzzy-option>
          }
        </formidable-autocomplete-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Animal
        </div>
        <div formidableFieldTooltip>
          <example-tooltip
            placement="right"
            trigger="click"
            [icon]="exampleTooltipSvg"
            [text]="'This field uses custom options. With fuzzy matching.'">
          </example-tooltip>
        </div>
      </formidable-field-decorator>

      <!-- Birthdate -->
      <formidable-field-decorator>
        <formidable-date-field
          formidableFieldErrors
          placeholder="?"
          name="birthdate"
          [disabled]="false"
          [readonly]="false"
          [ngModel]="vm.formValue$.birthdate"
          [i18n]="I18N_CONFIG"
          [yearRange]="2"
          [showMonthAfterYear]="true"
          [showDaysInNextAndPreviousMonths]="true"
          [unicodeTokenFormat]="'dd . MM . yyyy'"
          (valueChanged)="onValueChanged('birthdate', $event)"
          (focusChanged)="onFocusChanged('birthdate', $event)">
        </formidable-date-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Birthdate
        </div>
      </formidable-field-decorator>

      <!-- Time -->
      <formidable-field-decorator>
        <formidable-time-field
          formidableFieldErrors
          placeholder="?"
          name="time"
          [disabled]="false"
          [readonly]="false"
          [ngModel]="vm.formValue$.time"
          [unicodeTokenFormat]="'HH : mm'"
          (valueChanged)="onValueChanged('time', $event)"
          (focusChanged)="onFocusChanged('time', $event)">
        </formidable-time-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Time
        </div>
      </formidable-field-decorator>

      <!-- Religion -->
      <formidable-field-decorator>
        <formidable-radio-group-field
          formidableFieldErrors
          name="religion"
          [disabled]="false"
          [readonly]="false"
          [ngModel]="vm.formValue$.religion"
          [options]="religionOptions"
          [emptyOption]="religionEmptyOption"
          [sortFn]="sortAlphabetically"
          (valueChanged)="onValueChanged('religion', $event)"
          (focusChanged)="onFocusChanged('religion', $event)">
          <formidable-field-option
            [value]="'atheist'"
            [label]="'Atheist'"
            [disabled]="false">
            Atheist
          </formidable-field-option>
          <formidable-field-option
            [value]="'agnostic'"
            [label]="'AGNOSTIC'"
            >Agnostic (other label)</formidable-field-option
          >
          <formidable-field-option [value]="'other'">Other (no label)</formidable-field-option>
          <formidable-field-option
            [value]="'custom'"
            [label]="'The Special One'"
            [match]="specialMatchFn">
            <p>I'm a special item</p>
            <pre>And I can have any content</pre>
          </formidable-field-option>
        </formidable-radio-group-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Religion
        </div>
        <div formidableFieldTooltip>
          <example-tooltip
            placement="right"
            trigger="click"
            [icon]="exampleTooltipSvg"
            [text]="'This is a radio group field. It can have a tooltip, too.'">
          </example-tooltip>
        </div>
        <div formidableFieldPrefix>Prefixes for groups show above the field.</div>
        <div formidableFieldSuffix>Suffix for groups show below the field.</div>
      </formidable-field-decorator>

      <!-- Allergies -->
      <formidable-field-decorator>
        <formidable-checkbox-group-field
          formidableFieldErrors
          name="allergies"
          [disabled]="false"
          [readonly]="false"
          [ngModel]="vm.formValue$.allergies"
          [options]="allergiesOptions"
          [emptyOption]="allergiesEmptyOption"
          [sortFn]="sortAlphabetically"
          (valueChanged)="onValueChanged('allergies', $event)"
          (focusChanged)="onFocusChanged('allergies', $event)">
          <formidable-field-option
            [value]="'lactose'"
            [label]="'Lactose'"
            [disabled]="false">
            Lactose
          </formidable-field-option>
          <formidable-field-option
            [value]="'gluten'"
            [label]="'GLUTEN'"
            >Gluten (other label)</formidable-field-option
          >
          <formidable-field-option [value]="'soy'">Soy (no label)</formidable-field-option>
          <formidable-field-option
            [value]="'custom'"
            [label]="'The Special One'"
            [match]="specialMatchFn">
            <p>I'm a special item</p>
            <pre>And I can have any content</pre>
          </formidable-field-option>
        </formidable-checkbox-group-field>
        <div
          formidableFieldLabel
          [isFloating]="true">
          Allergies
        </div>
      </formidable-field-decorator>

      <!-- Custom Color Picker -->
      <!-- <formidable-field-decorator>
      <formidable-input-field
        formidableFieldErrors
        placeholder="Color"
        name="color"
        [ngModel]="vm.formValue.color">
      </formidable-input-field>
      <div
        formidableFieldLabel
        [isFloating]="true">
        Color
      </div>
      <div formidableFieldPrefix>Prefix</div>
    </formidable-field-decorator> -->

      <!-- Passwords Group -->
      <!-- TODO add form group -->
      <!-- Submit -->
      <div class="footer">
        <button
          type="submit"
          class="submit-button"
          [disabled]="!vm.isValid$">
          Submit
        </button>
      </div>
    }
  </fieldset>
</form>

<!-- Debugging Output -->
@if (viewModel$ | async; as vm) {
  <div class="debug-output">
    <div class="debug-toggle">
      <button (click)="toggleDebug()">
        {{ debugExpanded ? 'Hide Debug' : 'Show Debug' }}
      </button>
    </div>

    <!-- Collapsible Debug Section -->
    <div
      *ngIf="debugExpanded"
      class="debug-columns">
      <!-- Left Column -->
      <div class="column left">
        <pre>Value:<br />{{ vm.formValue$ | json }}</pre>
      </div>

      <!-- Middle Column -->
      <div class="column middle">
        <pre>Errors:<br />{{ vm.errors$ | json }}</pre>
        <pre>Dirty: {{ vm.isDirty$ | json }}</pre>
        <pre>Valid: {{ vm.isValid$ | json }}</pre>
      </div>

      <!-- Right Column (Log) -->
      <div class="column right">
        <div class="log-panel">
          <div class="log-header">
            <h4>Log Output</h4>
            <button (click)="clearLogs()">Clear</button>
          </div>
          <div class="log-messages">
            <div
              *ngFor="let message of logs"
              class="log-entry">
              {{ message }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
}
