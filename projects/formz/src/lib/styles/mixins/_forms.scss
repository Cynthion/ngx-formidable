@use 'sass:math';
@use 'typography' as typo;
@use 'spacings' as sp;

// SCSS Variables for default styling
$formz-color-validation-error: red;
$formz-color-field-placeholder: violet;
$formz-color-field-selection: pink;
$formz-color-field-border: turquoise;
$formz-color-field-border-focus: rgb(11, 87, 79);
$formz-color-field-background: yellow;
$formz-color-field-hover: rgba(0, 0, 0, 0.31);
$formz-color-field-label-floating: orange;

$formz-field-height: 66px;
$formz-field-label-floating-offset: 35px;

$formz-field-border-radius: 4px;

$formz-dropdown-panel-background: lime;
$formz-dropdown-panel-box-shadow: 0 12px 48px -8px rgb(0 0 0 / 12%);

$formz-hover-duration-short: 0.15s;
$formz-hover-easing: cubic-bezier(0.39, 0.575, 0.565, 1);

$formz-flyout-z-index: 9999;

// CSS Variables for configuration and overrides
:root {
  --formz-color-validation-error: #{$formz-color-validation-error};
  --formz-color-field-placeholder: #{$formz-color-field-placeholder};
  --formz-color-field-selection: #{$formz-color-field-selection};
  --formz-color-field-border: #{$formz-color-field-border};
  --formz-color-field-border-focus: #{$formz-color-field-border-focus};
  --formz-color-field-background: #{$formz-color-field-background};
  --formz-color-field-hover: #{$formz-color-field-hover};
  --formz-color-field-label-floating: #{$formz-color-field-label-floating};

  --formz-field-height: #{$formz-field-height};
  --formz-field-label-floating-offset: #{$formz-field-label-floating-offset};

  --formz-field-border-radius: #{$formz-field-border-radius};

  --formz-dropdown-panel-background: #{$formz-dropdown-panel-background};
  --formz-dropdown-panel-box-shadow: #{$formz-dropdown-panel-box-shadow};

  --formz-hover-duration-short: #{$formz-hover-duration-short};
  --formz-hover-easing: #{$formz-hover-easing};

  --formz-flyout-z-index: #{$formz-flyout-z-index};
}

@mixin input-reset {
  outline: 0;
  hyphens: none;
  appearance: none;

  &:focus {
    outline: 0;
  }
}

@mixin field-disabled {
  opacity: 0.65;
  cursor: not-allowed;
  pointer-events: none;
}

/**
 * Styling for input and textarea elements.
 */
@mixin field {
  @include input-reset;
  @include typo.font-m-bold;

  position: relative;
  width: 100%;
  height: $formz-field-height;
  padding: 0 sp.cmp_space(16); // horizontal padding only
  border: 1px solid var(--formz-color-field-border, #{$formz-color-field-border});
  border-radius: var(--formz-field-border-radius, #{$formz-field-border-radius});
  background: var(--formz-color-field-background, #{$formz-color-field-background});
  transition: box-shadow var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing}),
    border-color var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing});

  &:disabled {
    @include field-disabled;
  }

  &:focus {
    border-color: var(--formz-color-field-border-focus, #{$formz-color-field-border-focus});
    box-shadow: inset 0 0 0 1px var(--formz-color-field-border-focus, #{$formz-color-field-border-focus});
  }

  &::selection {
    background-color: var(--formz-color-field-selection, #{$formz-color-field-selection});
  }

  &::placeholder {
    color: var(--formz-color-field-placeholder, #{$formz-color-field-placeholder});
  }
}

// @mixin group-field {
//   @include input-reset; // TODO required?
//   @include typo.font-m-bold;

//   position: relative;
//   width: 100%;
//   height: $formz-field-height;
//   padding: 0 sp.cmp_space(16); // horizontal padding only
//   border: 1px solid var(--formz-color-field-border, #{$formz-color-field-border});
//   border-radius: var(--formz-field-border-radius, #{$formz-field-border-radius});
//   background: var(--formz-color-field-background, #{$formz-color-field-background});
//   transition: box-shadow var(--formz-hover-duration-short, #{$formz-hover-duration-short})
//       var(--formz-hover-easing, #{$formz-hover-easing}),
//     border-color var(--formz-hover-duration-short, #{$formz-hover-duration-short})
//       var(--formz-hover-easing, #{$formz-hover-easing});

//   &:disabled {
//     @include field-disabled;
//   }

//   &:focus {
//     border-color: var(--formz-color-field-border-focus, #{$formz-color-field-border-focus});
//     box-shadow: inset 0 0 0 1px var(--formz-color-field-border-focus, #{$formz-color-field-border-focus});
//   }

//   &::selection {
//     background-color: var(--formz-color-field-selection, #{$formz-color-field-selection});
//   }

//   &::placeholder {
//     color: var(--formz-color-field-placeholder, #{$formz-color-field-placeholder});
//   }
// }

@mixin field-before {
  display: flex;
  align-items: center;
  margin-bottom: sp.cmp_space(8);
  position: relative;
}

@mixin field-label {
  @include typo.font-m-bold;

  pointer-events: none;
  margin-right: sp.cmp_space(8); // space between label and tooltip

  // animation
  transform: translateY(0) scale(1); // default placement
  transform-origin: left top;
  transition: transform var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing}),
    margin-right var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing}),
    font-size var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing}),
    color var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing});
}

@mixin field-label-floating {
  @include typo.font-s-bold;

  position: absolute;
  left: sp.cmp_space(16);
  margin-right: 0;
  color: var(--formz-color-field-label-floating, #{$formz-color-field-label-floating});
  z-index: 1; // keep on top of field

  // animation
  transform: translateY($formz-field-label-floating-offset) scale(1);
}

@mixin field-tooltip {
  // tbd
}

@mixin field-prefix {
  position: absolute;
  top: math.div(var(--formz-field-height, #{formz-field-height}), 2);
  left: 0;
  padding-left: sp.cmp_space(16);
  padding-right: sp.cmp_space(16);
  transform: translateY(-50%);
  pointer-events: none;
  z-index: 1; // keep on top of field
}

@mixin field-suffix {
  position: absolute;
  top: math.div(var(--formz-field-height, #{formz-field-height}), 2);
  right: 0;
  padding-left: sp.cmp_space(16);
  padding-right: sp.cmp_space(16);
  transform: translateY(-50%);
  pointer-events: none;
  z-index: 1; // keep on top of field
}

@mixin field-validation-errors {
  margin-top: sp.cmp_space(8);
  margin-bottom: sp.cmp_space(16);
}

@mixin field-validation-error {
  @include typo.font-xs;

  display: block;
  color: var(--formz-color-validation-error, #{$formz-color-validation-error});
}

@mixin field-dropdown {
  height: $formz-field-height; // ensure same height as field

  &.open .dropdown-panel {
    // animation
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
}

@mixin field-dropdown-trigger {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 100%;
  width: 100%;
  cursor: pointer;
  user-select: none;

  .caret {
    float: right;
    transition: transform var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing});
  }

  .caret.rotated {
    transform: rotate(180deg);
  }
}

@mixin field-dropdown-panel {
  position: absolute;
  box-shadow: var(--formz-dropdown-panel-box-shadow, #{$formz-dropdown-panel-box-shadow});
  border: 1px solid var(--formz-color-field-border, #{$formz-color-field-border});
  border-radius: var(--formz-field-border-radius, #{$formz-field-border-radius});
  background: var(--formz-dropdown-panel-background, #{$formz-dropdown-panel-background});
  overflow: hidden; // clip inner content to border-radius
  z-index: var(--formz-flyout-z-index, #{$formz-flyout-z-index}); // keep on top of field

  // extend 1px to top, left and right
  top: calc(100% + 1px);
  left: -1px;
  width: calc(100% + 2px);

  // animation
  opacity: 0;
  transform: translateY(-0.25rem); // slight offset when closed
  pointer-events: none; // prevent hover/clicks when closed
  transition: opacity var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing}),
    transform var(--formz-hover-duration-short, #{$formz-hover-duration-short})
      var(--formz-hover-easing, #{$formz-hover-easing});
}

@mixin field-dropdown-option {
  padding: 0.5rem 1rem;
  cursor: pointer;

  &:hover {
    background: var(--formz-color-field-hover, #{$formz-color-field-hover});
  }
}
