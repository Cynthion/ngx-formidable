{"version":3,"file":"SuiteSerializer.development.js","sources":["../../../vestjs-runtime/src/Isolate/IsolateKeys.ts","../../src/core/StateMachines/CommonStateMachine.ts","../../src/core/StateMachines/IsolateTestStateMachine.ts","../../src/exports/SuiteSerializer.ts"],"sourcesContent":["export enum IsolateKeys {\n  Type = '$type',\n  Keys = 'keys',\n  Key = 'key',\n  Parent = 'parent',\n  Data = 'data',\n  AllowReorder = 'allowReorder',\n  Status = 'status',\n  AbortController = 'abortController',\n  Children = 'children',\n}\n\nexport const ExcludedFromDump = new Set([\n  IsolateKeys.AbortController,\n  IsolateKeys.Parent,\n  IsolateKeys.Keys,\n]);\n","import { StateMachine, TStateMachine, ValueOf } from 'vest-utils';\n\nexport const CommonStates = {\n  PENDING: 'PENDING',\n  INITIAL: 'INITIAL',\n  DONE: 'DONE',\n};\n\nconst State = {\n  [CommonStates.PENDING]: CommonStates.PENDING,\n  [CommonStates.INITIAL]: CommonStates.INITIAL,\n  [CommonStates.DONE]: CommonStates.DONE,\n};\n\nexport type State = ValueOf<typeof State>;\n\nconst machine: TStateMachine<State> = {\n  initial: State.INITIAL,\n  states: {\n    [State.DONE]: {},\n    [State.INITIAL]: {\n      [State.PENDING]: State.PENDING,\n      [State.DONE]: State.DONE,\n    },\n    [State.PENDING]: {\n      [State.DONE]: State.DONE,\n    },\n  },\n};\n\nexport const CommonStateMachine = StateMachine<State>(machine);\n","import { StateMachine, TStateMachine, ValueOf } from 'vest-utils';\n\nimport { CommonStates } from 'CommonStateMachine';\n\nexport const TestStatus = {\n  [CommonStates.PENDING]: CommonStates.PENDING,\n  CANCELED: 'CANCELED',\n  FAILED: 'FAILED',\n  OMITTED: 'OMITTED',\n  PASSING: 'PASSING',\n  SKIPPED: 'SKIPPED',\n  UNTESTED: 'UNTESTED',\n  WARNING: 'WARNING',\n};\n\nexport const TestAction = {\n  RESET: 'RESET',\n};\n\nexport type TestStatus = ValueOf<typeof TestStatus>;\nexport type TestAction = ValueOf<typeof TestAction>;\n\nexport type TestStateMachineAction = TestAction | TestStatus;\n\nconst machine: TStateMachine<TestStatus, TestStateMachineAction> = {\n  initial: TestStatus.UNTESTED,\n  states: {\n    '*': {\n      [TestStatus.OMITTED]: TestStatus.OMITTED,\n      [TestAction.RESET]: TestStatus.UNTESTED,\n    },\n    [TestStatus.UNTESTED]: {\n      [TestStatus.CANCELED]: TestStatus.CANCELED,\n      [TestStatus.FAILED]: TestStatus.FAILED,\n\n      [TestStatus.PASSING]: TestStatus.PASSING,\n      [TestStatus.PENDING]: TestStatus.PENDING,\n      [TestStatus.SKIPPED]: TestStatus.SKIPPED,\n      [TestStatus.WARNING]: TestStatus.WARNING,\n    },\n    [TestStatus.PENDING]: {\n      [TestStatus.CANCELED]: TestStatus.CANCELED,\n      [TestStatus.FAILED]: TestStatus.FAILED,\n\n      [TestStatus.PASSING]: TestStatus.PASSING,\n      [TestStatus.SKIPPED]: [\n        TestStatus.SKIPPED,\n        (force?: boolean) => force === true,\n      ],\n      [TestStatus.WARNING]: TestStatus.WARNING,\n    },\n    [TestStatus.SKIPPED]: {},\n    [TestStatus.FAILED]: {},\n    [TestStatus.WARNING]: {},\n    [TestStatus.PASSING]: {},\n    [TestStatus.CANCELED]: {},\n    [TestStatus.OMITTED]: {},\n  },\n};\n\nexport const IsolateTestStateMachine = StateMachine<\n  TestStatus,\n  TestStateMachineAction\n>(machine);\n","import { CB } from 'vest-utils';\nimport { IsolateSerializer } from 'vestjs-runtime';\nimport { IsolateKeys } from 'vestjs-runtime/src/Isolate/IsolateKeys';\n\nimport { TIsolateSuite } from 'IsolateSuite';\nimport { TestStatus } from 'IsolateTestStateMachine';\nimport { TFieldName, TGroupName } from 'SuiteResultTypes';\nimport { Suite } from 'SuiteTypes';\n\nexport type Dumpable = {\n  dump: CB<TIsolateSuite>;\n};\n\nexport class SuiteSerializer {\n  static serialize(suite: Dumpable) {\n    const dump = { ...suite.dump() };\n\n    return IsolateSerializer.serialize(dump, suiteSerializerReplacer);\n  }\n\n  static deserialize(\n    serialized: string | TIsolateSuite | Record<string, any>,\n  ): TIsolateSuite {\n    return IsolateSerializer.deserialize(serialized) as TIsolateSuite;\n  }\n\n  static resume(\n    suite: Suite<TFieldName, TGroupName>,\n    root: string | TIsolateSuite | Record<string, any>,\n  ): void {\n    const suiteRoot = SuiteSerializer.deserialize(root);\n\n    suite.resume(suiteRoot);\n  }\n}\n\nfunction suiteSerializerReplacer(value: any, key: string) {\n  if (key === 'output') {\n    return undefined;\n  }\n\n  if (key === IsolateKeys.Status) {\n    if (AllowedStatuses.has(value)) {\n      return value;\n    }\n\n    return undefined;\n  }\n\n  if (DisallowedKeys.has(key)) {\n    return undefined;\n  }\n\n  return value;\n}\n\nconst AllowedStatuses = new Set([\n  TestStatus.FAILED,\n  TestStatus.PASSING,\n  TestStatus.WARNING,\n]);\n\nconst DisallowedKeys = new Set(['focusMode', 'match', 'matchAll', 'severity']);\n"],"names":["machine","StateMachine","IsolateSerializer"],"mappings":"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"}