!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("n4s"),require("vest-utils"),require("vestjs-runtime"),require("context")):"function"==typeof define&&define.amd?define(["exports","n4s","vest-utils","vestjs-runtime","context"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).vest={},t.n4s,t["vest-utils"],t["vestjs-runtime"],t.context)}(this,(function(t,e,n,s,i){"use strict";const r={Each:"Each",Focused:"Focused",Group:"Group",OmitWhen:"OmitWhen",SkipWhen:"SkipWhen",Suite:"Suite",Test:"Test"};class a{static setOptionalField(t,e,s){const i=t.data.optional,r=i[e];n.assign(i,{[e]:n.assign({},r,s(r))})}static getOptionalField(t,e){var n;return null!==(n=a.getOptionalFields(t)[e])&&void 0!==n?n:{}}static getOptionalFields(t){var e,n;return null!==(n=null===(e=t.data)||void 0===e?void 0:e.optional)&&void 0!==n?n:{}}}var u,o;!function(t){t[t.CUSTOM_LOGIC=0]="CUSTOM_LOGIC",t[t.AUTO=1]="AUTO"}(u||(u={})),t.Modes=void 0,(o=t.Modes||(t.Modes={})).EAGER="EAGER",o.ALL="ALL",o.ONE="ONE";const c=i.createCascade(((e,s)=>s?null:n.assign({inclusion:{},mode:n.tinyState.createTinyState(t.Modes.EAGER),suiteParams:[],testMemoCache:f},e)));function l(){return c.useX().inclusion}function d(){return c.useX().mode()}const f=n.cache(10);function E(t){var i;const r=s.VestRuntime.useAvailableRoot(),o=c.useX().suiteParams,l=null!==(i=null==o?void 0:o[0])&&void 0!==i?i:{};if(n.isArray(t)||n.isStringValue(t))n.asArray(t).forEach((t=>{a.setOptionalField(r,t,(()=>({type:u.AUTO,applied:!!n.hasOwnProperty(l,t)&&e.enforce.isBlank().test(null==l?void 0:l[t]),rule:null})))}));else for(const n in t){const s=t[n];a.setOptionalField(r,n,(()=>({type:u.CUSTOM_LOGIC,rule:s,applied:e.enforce.isBlank().test(s)||!0===s})))}}function g(t){var e,n;if(!t)return!1;const i=s.VestRuntime.useAvailableRoot();return null!==(n=null===(e=a.getOptionalField(i,t))||void 0===e?void 0:e.applied)&&void 0!==n&&n}var N;!function(t){t.HOOK_CALLED_OUTSIDE="hook called outside of a running suite.",t.EXPECTED_VEST_TEST="Expected value to be an instance of IsolateTest",t.FIELD_NAME_REQUIRED="Field name must be passed",t.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION="Suite must be initialized with a function",t.PROMISIFY_REQUIRE_FUNCTION="Vest.Promisify must be called with a function",t.PARSER_EXPECT_RESULT_OBJECT="Vest parser: expected argument at position 0 to be Vest's result object.",t.WARN_MUST_BE_CALLED_FROM_TEST="Warn must be called from within the body of a test function",t.EACH_CALLBACK_MUST_BE_A_FUNCTION="Each must be called with a function",t.INVALID_PARAM_PASSED_TO_FUNCTION='Incompatible params passed to {fn_name} function. "{param}" must be of type {expected}',t.TESTS_CALLED_IN_DIFFERENT_ORDER='Vest Critical Error: Tests called in different order than previous run.\n    expected: {fieldName}\n    received: {prevName}\n    This can happen on one of two reasons:\n    1. You\'re using if/else statements to conditionally select tests. Instead, use "skipWhen".\n    2. You are iterating over a list of tests, and their order changed. Use "each" and a custom key prop so that Vest retains their state.',t.UNEXPECTED_TEST_REGISTRATION_ERROR="Unexpected error encountered during test registration.\n      Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.\n      Error: {error}.",t.UNEXPECTED_TEST_RUN_ERROR="Unexpected error encountered during test run. Please report this issue to Vest's Github repository.\n      Test Object: {testObject}.",t.INCLUDE_SELF="Trying to call include.when on the same field."}(N||(N={}));const T="PENDING",S="INITIAL",R="DONE",m={[T]:T,[S]:S,[R]:R},p={initial:m.INITIAL,states:{[m.DONE]:{},[m.INITIAL]:{[m.PENDING]:m.PENDING,[m.DONE]:m.DONE},[m.PENDING]:{[m.DONE]:m.DONE}}},I=n.StateMachine(p),v={[T]:T,CANCELED:"CANCELED",FAILED:"FAILED",OMITTED:"OMITTED",PASSING:"PASSING",SKIPPED:"SKIPPED",UNTESTED:"UNTESTED",WARNING:"WARNING"},D="RESET",O={initial:v.UNTESTED,states:{"*":{[v.OMITTED]:v.OMITTED,[D]:v.UNTESTED},[v.UNTESTED]:{[v.CANCELED]:v.CANCELED,[v.FAILED]:v.FAILED,[v.PASSING]:v.PASSING,[v.PENDING]:v.PENDING,[v.SKIPPED]:v.SKIPPED,[v.WARNING]:v.WARNING},[v.PENDING]:{[v.CANCELED]:v.CANCELED,[v.FAILED]:v.FAILED,[v.PASSING]:v.PASSING,[v.SKIPPED]:[v.SKIPPED,t=>!0===t],[v.WARNING]:v.WARNING},[v.SKIPPED]:{},[v.FAILED]:{},[v.WARNING]:{},[v.PASSING]:{},[v.CANCELED]:{},[v.OMITTED]:{}}},A=n.StateMachine(O);var _,h,C,P,F,y;function L(t){return t===_.ERRORS?h.ERROR_COUNT:h.WARN_COUNT}!function(t){t.WARNINGS="warnings",t.ERRORS="errors"}(_||(_={})),function(t){t.ERROR_COUNT="errorCount",t.WARN_COUNT="warnCount"}(h||(h={})),function(t){t.Error="error",t.Warning="warning"}(C||(C={}));class W{static getStatus(t){var e;return null!==(e=t.status)&&void 0!==e?e:S}static setStatus(t,e,n){t.status=this.stateMachine.staticTransition(W.getStatus(t),e,n)}static statusEquals(t,e){return W.getStatus(t)===e}static setPending(t){this.setStatus(t,T)}static setDone(t){this.setStatus(t,R)}static isPending(t){return W.statusEquals(t,T)}}W.stateMachine=I;class U extends W{static getData(t){return n.invariant(t.data),t.data}static is(t){return s.IsolateSelectors.isIsolateType(t,r.Test)}static isX(t){n.invariant(U.is(t),N.EXPECTED_VEST_TEST)}static cast(t){return U.isX(t),t}static warns(t){return U.getData(t).severity===C.Warning}static isOmitted(t){return U.statusEquals(t,v.OMITTED)}static isUntested(t){return U.statusEquals(t,v.UNTESTED)}static isFailing(t){return U.statusEquals(t,v.FAILED)}static isCanceled(t){return U.statusEquals(t,v.CANCELED)}static isSkipped(t){return U.statusEquals(t,v.SKIPPED)}static isPassing(t){return U.statusEquals(t,v.PASSING)}static isWarning(t){return U.statusEquals(t,v.WARNING)}static hasFailures(t){return U.isFailing(t)||U.isWarning(t)}static isNonActionable(t){return U.isSkipped(t)||U.isOmitted(t)||U.isCanceled(t)}static isTested(t){return U.hasFailures(t)||U.isPassing(t)}static awaitsResolution(t){return U.isSkipped(t)||U.isUntested(t)||U.isPending(t)}static isAsyncTest(t){return n.isPromise(U.getData(t).asyncTest)}static fail(t){U.setStatus(t,U.warns(t)?v.WARNING:v.FAILED)}static pass(t){U.setStatus(t,v.PASSING)}static warn(t){U.setData(t,(t=>Object.assign(Object.assign({},t),{severity:C.Warning})))}static setData(t,e){t.data=n.optionalFunctionValue(e,U.getData(t))}static skip(t,e){U.setStatus(t,v.SKIPPED,e)}static cancel(t){U.setStatus(t,v.CANCELED),s.IsolateMutator.abort(t,v.CANCELED)}static omit(t){U.setStatus(t,v.OMITTED)}static reset(t){U.setStatus(t,D)}}function G(t,e){return!!e&&!b(t,e)}function b(t,e){return!(!e||t.fieldName!==e)}function V(t,e){const{groupName:n}=U.getData(t),{groupName:s,fieldName:i}=U.getData(e);return b(U.getData(t),i)&&n===s&&t.key==e.key}function M(t,e){return s.Isolate.create(r.Focused,n.noop,{focusMode:t,match:n.asArray(e).filter(n.isStringValue),matchAll:!0===e})}U.stateMachine=A,function(t){t[t.ONLY=0]="ONLY",t[t.SKIP=1]="SKIP"}(P||(P={}));class k{static isSkipFocused(t,e){return(null==t?void 0:t.data.focusMode)===P.SKIP&&(x(t,e)||!0===t.data.matchAll)}static isOnlyFocused(t,e){return(null==t?void 0:t.data.focusMode)===P.ONLY&&x(t,e)}static isIsolateFocused(t){return s.IsolateSelectors.isIsolateType(t,r.Focused)}}function w(t){return M(P.ONLY,j(t))}function B(t){return M(P.SKIP,j(t))}function j(t){return!1===t?[]:t}function x(t,e){var s,i;return n.isNotEmpty(null==t?void 0:t.data.match)&&(!e||(null===(i=null===(s=null==t?void 0:t.data.match)||void 0===s?void 0:s.includes(e))||void 0===i||i))}class H{constructor(){this.errorCount=0,this.warnCount=0,this.testCount=0,this.pendingCount=0}}class K extends H{constructor(){super(...arguments),this[F]=[],this[y]=[],this.groups={},this.tests={},this.valid=null}}F=_.ERRORS,y=_.WARNINGS;const X=n.cache(),q=n.cache();function Y(){return s.VestRuntime.useXAppData()}function z(){return Y().doneCallbacks()}function J(){return Y().fieldCallbacks()}function Q(){return Y().suiteId}function Z(){Y().suiteResultCache.invalidate([Q()]),q.invalidate([Q()])}function $(){const[,,t]=z(),[,,e]=J();t(),e()}function tt(t){s.VestRuntime.useSetHistoryRoot(t),Z()}function et(t,e,s){return s?function(t,e,n){var s;return(null===(s=null==t?void 0:t[n])||void 0===s?void 0:s[e])||[]}(t,e,s):function(t,e){const s={},i=L(e);for(const r in t)n.isPositive(t[r][i])&&(s[r]=t[r][e]||[]);return s}(t,e)}function nt(t){const e={getError:i,getErrors:function(e){return st(t,_.ERRORS,e)},getErrorsByGroup:function(e,n){return it(t,_.ERRORS,e,n)},getMessage:function(t){return i(t)||s(t)},getWarning:s,getWarnings:function(e){return st(t,_.WARNINGS,e)},getWarningsByGroup:function(e,n){return it(t,_.WARNINGS,e,n)},hasErrors:function(e){return ut(t,h.ERROR_COUNT,e)},hasErrorsByGroup:function(e,n){return at(t,h.ERROR_COUNT,e,n)},hasWarnings:function(e){return ut(t,h.WARN_COUNT,e)},hasWarningsByGroup:function(e,n){return at(t,h.WARN_COUNT,e,n)},isPending:function(e){var s;return e?n.greaterThan(null===(s=t.tests[e])||void 0===s?void 0:s.pendingCount,0):n.greaterThan(t.pendingCount,0)},isTested:function(e){var s;return n.isPositive(null===(s=t.tests[e])||void 0===s?void 0:s.testCount)},isValid:function(e){var n;return Boolean(e?null===(n=t.tests[e])||void 0===n?void 0:n.valid:t.valid)},isValidByGroup:function(e,n){const s=t.groups[e];if(!s)return!1;if(n)return rt(s,n);for(const t in s)if(!rt(s,t))return!1;return!0}};return e;function s(e){return ot(_.WARNINGS,t,e)}function i(e){return ot(_.ERRORS,t,e)}}function st(t,e,n){return et(t.tests,e,n)}function it(t,e,n,s){return et(t.groups[n],e,s)}function rt(t,e){var n;return!!(null===(n=t[e])||void 0===n?void 0:n.valid)}function at(t,e,s,i){var r,a;const u=t.groups[s];if(!u)return!1;if(i)return n.isPositive(null===(r=u[i])||void 0===r?void 0:r[e]);for(const t in u)if(n.isPositive(null===(a=u[t])||void 0===a?void 0:a[e]))return!0;return!1}function ut(t,e,s){var i;const r=s?null===(i=t.tests[s])||void 0===i?void 0:i[e]:t[e]||0;return n.isPositive(r)}function ot(t,e,n){var s;const i=e[t];return n?null===(s=i.find((t=>b(t,n))))||void 0===s?void 0:s.message:i[0]}class ct{constructor(t,e,n){this.fieldName=t,this.message=e,this.groupName=n}static fromTestObject(t){const{fieldName:e,message:n,groupName:s}=U.getData(t);return new ct(e,n,s)}}class lt{static hasNoTests(t=lt.defaultRoot()){return!t||!s.Walker.has(t,U.is)}static someTests(t,e=lt.defaultRoot()){return!!e&&s.Walker.some(e,(e=>(U.isX(e),t(e))),U.is)}static everyTest(t,e=lt.defaultRoot()){return!!e&&s.Walker.every(e,(e=>(U.isX(e),t(e))),U.is)}static walkTests(t,e=lt.defaultRoot()){e&&s.Walker.walk(e,((e,n)=>{t(U.cast(e),n)}),U.is)}static reduceTests(t,e,n=lt.defaultRoot()){return n?s.Walker.reduce(n,((e,n,s)=>t(e,U.cast(n),s)),e,U.is):e}static pluckTests(t,e=lt.defaultRoot()){e&&s.Walker.pluck(e,(e=>(U.isX(e),t(e))),U.is)}static resetField(t){lt.walkTests((e=>{b(U.getData(e),t)&&U.reset(e)}),lt.defaultRoot())}static removeTestByFieldName(t,e=lt.defaultRoot()){lt.pluckTests((e=>b(U.getData(e),t)),e)}}lt.defaultRoot=s.VestRuntime.useAvailableRoot;class dt{static useHasPending(t){if(!dt.defaultRoot())return!1;const e=dt.usePreAggs().pending;return!n.isEmpty(e)&&e.some(n.Predicates.all(null==t||t))}static usePreAggs(){return t=ft,(0,Y().preAggCache)([Q()],t);var t}static useHasRemainingWithTestNameMatching(t){return dt.useHasPending(n.Predicates.any(n.isNullish(t),n.Predicates.all(U.is,(e=>function(t,e){return!e||b(t,e)}(U.getData(e),t)))))}}function ft(){const t=dt.defaultRoot(),e={pending:[],failures:{errors:{},warnings:{}}};return t?s.Walker.reduce(t,((t,e)=>{var n,s;if(W.isPending(e)&&t.pending.push(e),U.is(e)){const i=U.getData(e).fieldName;U.isWarning(e)&&(t.failures.warnings[i]=null!==(n=t.failures.warnings[i])&&void 0!==n?n:[],t.failures.warnings[i].push(e)),U.isFailing(e)&&(t.failures.errors[i]=null!==(s=t.failures.errors[i])&&void 0!==s?s:[],t.failures.errors[i].push(e))}return t}),e):e}dt.defaultRoot=s.VestRuntime.useAvailableRoot;const Et=n.bindNot((function(t,e){return U.getData(t).groupName===e}));function gt(t){return function(t,e){const s=dt.usePreAggs().failures;if(n.isEmpty(s[t]))return!1;if(e)return!n.isEmpty(s[t][e]);return!0}(_.ERRORS,t)}function Nt(t,e,s){return lt.someTests((i=>!Et(i,e)&&function(t,e,s){if(!U.hasFailures(t))return!1;if(G(U.getData(t),s))return!1;if(function(t,e){return n.either(t===_.WARNINGS,U.warns(e))}(e,t))return!1;return!0}(i,t,s)))}function Tt(t){return!!g(t)||!lt.hasNoTests()&&(!gt(t)&&(!function(t){return dt.useHasPending(n.Predicates.all(U.is,(e=>!G(U.getData(e),t)),(()=>!g(t))))}(t)&&function(t){return lt.everyTest((e=>Rt(e,t)))}(t)))}function St(t,e){return!!g(e)||!Nt(_.ERRORS,t,e)&&(!function(t,e){return dt.useHasPending(n.Predicates.all(U.is,(e=>!Et(e,t)),(t=>!G(U.getData(t),e)),(()=>!g(e))))}(t,e)&&function(t,e){return lt.everyTest((n=>!!Et(n,t)||Rt(n,e)))}(t,e))}function Rt(t,e){return!!G(U.getData(t),e)||(U.isOmitted(t)||U.isTested(t)||function(t){const e=s.VestRuntime.useAvailableRoot(),{fieldName:n}=U.getData(t);return a.getOptionalField(e,n).type===u.AUTO&&U.awaitsResolution(t)}(t))}function mt(){const t=lt.reduceTests(((t,e)=>{const n=U.getData(e).fieldName;return t.tests[n]=function(t,e){const n=U.getData(e).fieldName,s=pt(t[n],e);return s.valid=!1!==s.valid&&Tt(n),s}(t.tests,e),t.groups=function(t,e){const{groupName:n,fieldName:s}=U.getData(e);if(!n)return t;t[n]=t[n]||{};const i=t[n];return i[s]=pt(i[s],e),i[s].valid=!1!==i[s].valid&&St(n,s),t}(t.groups,e),U.isOmitted(e)?t:(!1===t.tests[n].valid&&(t.valid=!1),function(t,e){U.isWarning(t)?(e.warnCount++,e.warnings.push(ct.fromTestObject(t))):U.isFailing(t)&&(e.errorCount++,e.errors.push(ct.fromTestObject(t)));U.isPending(t)&&e.pendingCount++;vt(t)&&e.testCount++;return e}(e,t))}),new K);return t.valid=!1!==t.valid&&Tt(),t}function pt(t,e){const{message:s}=U.getData(e),i=n.defaultTo(t?Object.assign({},t):null,It);return U.isNonActionable(e)||(U.isPending(e)&&i.pendingCount++,U.isFailing(e)?r(_.ERRORS):U.isWarning(e)&&r(_.WARNINGS),vt(e)&&i.testCount++),i;function r(t){const e=L(t);i[e]++,s&&(i[t]=(i[t]||[]).concat(s))}}function It(){return n.assign(new H,{errors:[],valid:!0,warnings:[]})}function vt(t){return U.isTested(t)||U.isPending(t)}function Dt(){return t=()=>{const t=mt(),e=Y().suiteName;return Object.freeze(Ot(t,e))},(0,Y().suiteResultCache)([Q()],t);var t}function Ot(t,e){return n.assign(t,nt(t),{suiteName:e})}function At(){const t=Ot(new K);return new Proxy(t,{get:(t,e)=>Dt()[e]})}function _t(t,e){s.Isolate.create(r.SkipWhen,(()=>{c.run({skipped:ht()||n.optionalFunctionValue(t,At())},e)}))}function ht(){return function(){var t;return null!==(t=c.useX().skipped)&&void 0!==t&&t}()}function Ct(t,e){return n.isNotNullish(s.Walker.findClosest(t,(t=>!!k.isIsolateFocused(t)&&k.isOnlyFocused(t,e))))}function Pt(t){const{fieldName:e}=U.getData(t);if(ht())return!0;const i=l(),r=function(t){return s.Walker.findClosest(t,(e=>{var n;if(!k.isIsolateFocused(e))return!1;const{fieldName:s}=U.getData(t);return(null===(n=e.data.match)||void 0===n?void 0:n.includes(s))||e.data.matchAll}))}(t);if(k.isSkipFocused(r))return!0;return!k.isOnlyFocused(r)&&(!!Ct(t)&&!n.optionalFunctionValue(i[e],t))}function Ft(t){const[e]=d();return e===t}function yt(e){return Ft(t.Modes.ONE)?gt():!!Ft(t.Modes.EAGER)&&gt(e.fieldName)}function Lt(t,e){s.Isolate.create(r.OmitWhen,(()=>{c.run({omitted:Wt()||n.optionalFunctionValue(t,At())},e)}))}function Wt(){return function(){var t;return null!==(t=c.useX().omitted)&&void 0!==t&&t}()}function Ut(t,e=t){const n=U.getData(t);return yt(n)?(s=t,U.skip(s),s):(i=n.fieldName,Wt()||g(i)?function(t){return U.omit(t),t}(t):Pt(t)?function(t){return U.skip(t,ht()),t}(e):t);var s,i}function Gt(t,e){return U.is(e)&&!V(e,t)}const bt=[class{static match(t,e){return U.is(t)&&U.is(e)}static reconcile(t,e){const i=Ut(t,function(t,e){if(s.IsolateInspector.usesKey(t))return function(t){return U.cast(s.Reconciler.handleIsolateNodeWithKey(t,(e=>!!U.isNonActionable(e)||!Pt(t))))}(t);if(s.Reconciler.dropNextNodesOnReorder(Gt,t,e))return function(t,e){if(s.IsolateInspector.canReorder(t))return;n.deferThrow(n.text(N.TESTS_CALLED_IN_DIFFERENT_ORDER,{fieldName:U.getData(t).fieldName,prevName:U.is(e)?U.getData(e).fieldName:void 0}))}(t,e),t;if(!U.is(e))return t;if(U.isOmitted(e))return t;return e}(t,e));return function(t,e,n){t===e&&U.is(e)&&(i=e)!==(s=n)&&V(s,i)&&U.isPending(s)&&U.cancel(s);var s,i}(i,t,e),i}}];function Vt(t,e){var n,s;return null!==(s=null===(n=bt.find((n=>n.match(t,e))))||void 0===n?void 0:n.reconcile(t,e))&&void 0!==s?s:null}function Mt(...t){const[e,n]=t.reverse();return s.Isolate.create(r.Group,(()=>c.run(Object.assign({},n&&{groupName:n}),e)))}function kt(t){n.invariant(n.isStringValue(t));return l()[t]=!0,{when:function(e){n.invariant(e!==t,N.INCLUDE_SELF);const s=l();s[t]=function(t){return n.isStringValue(e)?Ct(t,e):n.optionalFunctionValue(e,n.optionalFunctionValue(Dt))}}}}function wt(t,e,n){const i=Object.assign(Object.assign({},{severity:C.Error,status:A.initial()}),{fieldName:e.fieldName,testFn:e.testFn});e.groupName&&(i.groupName=e.groupName),e.message&&(i.message=e.message);return s.Isolate.create(r.Test,t,i,null!=n?n:null)}function Bt(t){if(Ut(t),U.isUntested(t))return function(t){const e=function(t){return c.run({currentTest:t},(()=>{let e;const{message:s,testFn:i}=U.getData(t);try{e=i({signal:t.abortController.signal})}catch(i){(function(t,e){return n.isUndefined(t)&&n.isStringValue(e)})(s,i)&&(U.getData(t).message=i),e=!1}return!1===e&&U.fail(t),e}))}(t);try{if(n.isPromise(e))return U.getData(t).asyncTest=e,function(t){const{asyncTest:e,message:i}=U.getData(t);if(!n.isPromise(e))return;const r=s.VestRuntime.persist((()=>{jt(t)})),a=s.VestRuntime.persist((e=>{U.isCanceled(t)||(U.getData(t).message=n.isStringValue(e)?e:i,U.fail(t),r())}));return e.then(r,a)}(t);jt(t)}catch(e){throw new Error(n.text(N.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t),error:e}))}}(t);U.isNonActionable(t)||n.deferThrow(n.text(N.UNEXPECTED_TEST_REGISTRATION_ERROR,{testObject:JSON.stringify(t)}))}function jt(t){U.pass(t)}function xt(t,...e){const[i,r,a]=n.isFunction(e[1])?e:[void 0,...e];!function(t,e){const s="test";n.invariant(n.isStringValue(t),n.text(N.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"fieldName",expected:"string"})),n.invariant(n.isFunction(e),n.text(N.INVALID_PARAM_PASSED_TO_FUNCTION,{fn_name:s,param:"callback",expected:"function"}))}(t,r);const u={fieldName:t,groupName:c.useX().groupName,message:i,testFn:r};return s.Bus.useEmit("TEST_RUN_STARTED"),wt(Bt,u,a)}const Ht=n.assign(xt,{memo:function(t){return function(e,...i){const[r,a,u]=i.reverse();return function(t,e){const i=c.useX().testMemoCache,r=i.get(t);if(n.isNull(r))return i(t,e);const[,a]=r;if(U.isCanceled(a))return i.invalidate(t),i(t,e);return s.VestRuntime.useSetNextIsolateChild(a),a}([Q(),e,s.VestRuntime.useCurrentCursor()].concat(r),(function(){return t(e,u,a)}))}}(xt)});function Kt(){return{group:Mt,include:kt,omitWhen:Lt,only:w,optional:E,skip:B,skipWhen:_t,test:Ht}}function Xt(){const t=s.VestRuntime.useAvailableRoot(),e=a.getOptionalFields(t);if(n.isEmpty(e))return;const i=new Set;function r(e){const{fieldName:n}=U.getData(e);i.has(n)&&(U.omit(e),a.setOptionalField(t,n,(t=>Object.assign(Object.assign({},t),{applied:!0}))))}lt.walkTests((e=>{if(U.isPending(e))return;const{fieldName:s}=U.getData(e);i.has(s)?r(e):function(e){const{fieldName:s}=U.getData(e),u=a.getOptionalField(t,s);!0===n.optionalFunctionValue(u.rule)&&i.add(s);r(e)}(e)})),s.Bus.useEmit("DONE_TEST_OMISSION_PASS")}function qt(){const t=s.Bus.useBus();return e("TEST_COMPLETED",(()=>{})),e("TEST_RUN_STARTED",(()=>{})),t.on(s.RuntimeEvents.ISOLATE_PENDING,(t=>{U.is(t)&&U.setPending(t),W.setPending(t)})),t.on(s.RuntimeEvents.ISOLATE_DONE,(e=>{U.is(e)&&t.emit("TEST_COMPLETED",e),W.setDone(e)})),t.on(s.RuntimeEvents.ASYNC_ISOLATE_DONE,(e=>{if(U.is(e)&&!U.isCanceled(e)){const{fieldName:t}=U.getData(e);!function(t){const[e]=J();t&&!dt.useHasRemainingWithTestNameMatching(t)&&n.isArray(e[t])&&n.callEach(e[t])}(t)}dt.useHasPending()||t.emit("ALL_RUNNING_TESTS_FINISHED")})),e("DONE_TEST_OMISSION_PASS",(()=>{})),t.on("ALL_RUNNING_TESTS_FINISHED",(()=>{lt.someTests(U.isAsyncTest)&&Xt(),function(){const[t]=z();n.callEach(t)}()})),e("RESET_FIELD",(t=>{lt.resetField(t)})),e("SUITE_RUN_STARTED",(()=>{$()})),e("SUITE_CALLBACK_RUN_FINISHED",(()=>{dt.useHasPending()||t.emit("ALL_RUNNING_TESTS_FINISHED"),Xt()})),e("REMOVE_FIELD",(t=>{lt.removeTestByFieldName(t)})),e("RESET_SUITE",(()=>{$(),s.VestRuntime.reset()})),{subscribe:function(...e){const[n,s]=e.reverse();return t.on(null!=s?s:"*",(()=>{n()})).off}};function e(e,n){t.on(e,((...t)=>{Z(),n(...t)}))}}function Yt(){return n.freezeAssign({done:s.VestRuntime.persist(zt)},Dt())}function zt(...t){const[e,s]=t.reverse(),i=Yt();if(function(t,e,s){var i,r;return!!(!n.isFunction(t)||e&&n.numberEquals(null!==(r=null===(i=s.tests[e])||void 0===i?void 0:i.testCount)&&void 0!==r?r:0,0))}(e,s,i))return i;const r=()=>e(Dt());return dt.useHasRemainingWithTestNameMatching(s)?(function(t,e){const[,s]=J(),[,i]=z();e?s((s=>n.assign(s,{[e]:(s[e]||[]).concat(t)}))):i((e=>e.concat(t)))}(r,s),i):(r(),i)}function Jt(...t){const[e,i]=n.asArray(t).reverse();!function(t){n.invariant(n.isFunction(t),N.SUITE_MUST_BE_INITIALIZED_WITH_FUNCTION)}(e);const a=function({suiteName:t,VestReconciler:e}){const i={doneCallbacks:n.tinyState.createTinyState((()=>[])),fieldCallbacks:n.tinyState.createTinyState((()=>({}))),preAggCache:q,suiteId:n.seq(),suiteName:t,suiteResultCache:X};return s.VestRuntime.createRef(e,i)}({suiteName:i,VestReconciler:Vt});function u(...t){return c.run({suiteParams:t},(()=>{return s.Bus.useEmit("SUITE_RUN_STARTED"),n=function(t,...e){const n=s.Bus.useEmit();return()=>(t(...e),n("SUITE_CALLBACK_RUN_FINISHED"),Yt())}(e,...t),s.Isolate.create(r.Suite,n,{optional:{}});var n})).output}const o=Qt(...t);return s.VestRuntime.Run(a,(()=>{const t=qt();return n.assign(s.VestRuntime.persist(u),Object.assign(Object.assign({dump:s.VestRuntime.persist((()=>s.VestRuntime.useAvailableRoot())),get:s.VestRuntime.persist(Dt),remove:s.Bus.usePrepareEmitter("REMOVE_FIELD"),reset:s.Bus.usePrepareEmitter("RESET_SUITE"),resetField:s.Bus.usePrepareEmitter("RESET_FIELD"),resume:s.VestRuntime.persist(tt),runStatic:(...t)=>o(...t),subscribe:t.subscribe},(e=s.VestRuntime.persist(Dt),{getError:(...t)=>e().getError(...t),getErrors:(...t)=>e().getErrors(...t),getErrorsByGroup:(...t)=>e().getErrorsByGroup(...t),getMessage:(...t)=>e().getMessage(...t),getWarning:(...t)=>e().getWarning(...t),getWarnings:(...t)=>e().getWarnings(...t),getWarningsByGroup:(...t)=>e().getWarningsByGroup(...t),hasErrors:(...t)=>e().hasErrors(...t),hasErrorsByGroup:(...t)=>e().hasErrorsByGroup(...t),hasWarnings:(...t)=>e().hasWarnings(...t),hasWarningsByGroup:(...t)=>e().hasWarningsByGroup(...t),isPending:(...t)=>e().isPending(...t),isTested:(...t)=>e().isTested(...t),isValid:(...t)=>e().isValid(...t),isValidByGroup:(...t)=>e().isValidByGroup(...t)})),Kt()));var e}))}function Qt(...t){return n.assign(((...e)=>{const s=Jt(...t),i=s(...e);return n.assign(new Promise((t=>{i.done((e=>{t(r(e))}))})),r(i));function r(t){return n.assign({dump:s.dump},t)}}),Object.assign({},Kt()))}const Zt=N.WARN_MUST_BE_CALLED_FROM_TEST;Object.defineProperty(t,"enforce",{enumerable:!0,get:function(){return e.enforce}}),t.create=Jt,t.each=function(t,e){n.invariant(n.isFunction(e),N.EACH_CALLBACK_MUST_BE_A_FUNCTION),function(t){s.Isolate.create(r.Each,t,{allowReorder:!0})}((()=>{t.forEach(((t,n)=>{e(t,n)}))}))},t.group=Mt,t.include=kt,t.mode=function(t){const[,e]=d();e(t)},t.omitWhen=Lt,t.only=w,t.optional=E,t.registerReconciler=function(t){bt.includes(t)||bt.push(t)},t.skip=B,t.skipWhen=_t,t.staticSuite=Qt,t.suiteSelectors=nt,t.test=Ht,t.warn=function(){const t=(e=N.HOOK_CALLED_OUTSIDE,c.useX(e).currentTest);var e;n.invariant(t,Zt),U.warn(t)}}));
//# sourceMappingURL=vest.production.js.map
