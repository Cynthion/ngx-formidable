<div
  #dropdownRef
  class="field"
  [class.is-readonly]="readonly"
  [class.is-disabled]="disabled"
  [class.focused]="isFieldFocused">
  <div
    class="input-wrapper"
    (mousedown)="!readonly && !disabled ? toggleMouseDown($event) : null"
    (pointerdown)="readonly || disabled ? preventPointerDown($event, inputRef) : null"
    (keydown)="readonly || disabled ? preventKeydown($event) : null">
    <!-- Input Field -->
    <input
      #inputRef
      type="text"
      autocomplete="off"
      class="wrapped-input"
      [id]="fieldId"
      [placeholder]="placeholder"
      [value]="selectedOption?.label"
      [attr.name]="name"
      [attr.readonly]="true"
      [attr.disabled]="disabled ? '' : null"
      (keydown)="onUserInput($event)"
      (focus)="onFocusChange(true)"
      (blur)="onFocusChange(false)" />

    <!-- Toggle -->
    @if (!readonly && !disabled) {
      <span
        #toggleRef
        class="dropdown-toggle"
        [class.open]="isPanelOpen"
        [class.arrow-down]="!isPanelOpen"
        [class.arrow-up]="isPanelOpen">
      </span>
    }
  </div>

  <!-- Panel -->
  <div
    #panelRef
    tabindex="-1"
    class="panel panel-{{ panelPosition }}"
    [class.open]="isPanelOpen"
    (mousedown)="panelMouseDown($event)">
    <div class="panel-scrollcontainer">
      <!-- Options -->
      <!-- Option components are re-created in order to control them. -->
      @for (option of options$ | async; track option.value; let i = $index) {
        <formidable-field-option
          #optionRef
          [value]="option.value"
          [label]="option.label"
          [readonly]="option.readonly || false"
          [disabled]="option.disabled || false"
          [selected]="option.value === value"
          [highlighted]="i === (highlightedOptionIndex$ | async)">
          <ng-container
            *ngIf="option.template; else labelContent"
            [ngTemplateOutlet]="option.template">
          </ng-container>
          <ng-template #labelContent>{{ option.label || option.value }}</ng-template>
        </formidable-field-option>
      } @empty {
        <formidable-field-option
          #optionRef
          [value]="emptyOption.value"
          [label]="emptyOption.label"
          [disabled]="true">
          {{ emptyOption.label || emptyOption.value }}
        </formidable-field-option>
      }
    </div>
  </div>
</div>
