@use 'css-icons' as icons;
@use 'utils' as utils;
@use '../tokens' as tokens;

@mixin icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;

  svg {
    width: 100%;
    height: 100%;
    fill: currentcolor;
    stroke: currentcolor;
    display: block;
  }
}

@mixin fieldset {
  @include fieldset-reset;
}

@mixin legend {
  position: absolute;
  width: utils.spacing(1);
  height: utils.spacing(1);
  padding: 0;
  margin: calc(utils.spacing(1) * -1);
  overflow: hidden;
  clip: rect(0 0 0 0);
  white-space: nowrap;
  border: 0;
}

@mixin fieldset-reset {
  border: 0;
  min-height: fit-content;
  padding: 0;
  margin: 0;
}

@mixin field-reset {
  outline: 0;
  hyphens: none;
  appearance: none;
  box-sizing: border-box;

  font: inherit;
  color: inherit;
  line-height: inherit;
  text-decoration: inherit;
}

@mixin wrapped-input {
  @include field-reset;
  @include selection-colors;
  @include placeholder-colors;

  background: transparent;
  width: 100%;
  height: calc(100% - (2 * var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness})));
  border: none;

  &[disabled] {
    cursor: not-allowed;
    pointer-events: none;
  }
}

@mixin selection-colors {
  &::selection {
    background-color: var(--formidable-color-field-selection, #{tokens.$formidable-color-field-selection});
  }
}

@mixin placeholder-colors {
  &::placeholder {
    color: var(--formidable-color-field-placeholder, #{tokens.$formidable-color-field-placeholder});
  }
}

@mixin readonly-colors {
  --formidable-color-field-border: var(--formidable-color-field-border-readonly);
  --formidable-color-field-group-border: var(--formidable-color-field-group-border-readonly);

  --formidable-color-field-background: var(--formidable-color-field-background-readonly);
  --formidable-color-field-group-background: var(--formidable-color-field-background-readonly);
  --formidable-color-field-text: var(--formidable-color-field-text-readonly);
  --formidable-color-field-group-text: var(--formidable-color-field-text-readonly);
}

@mixin disabled-colors {
  --formidable-color-field-border: var(--formidable-color-field-border-disabled);
  --formidable-color-field-group-border: var(--formidable-color-field-group-border-disabled);

  --formidable-color-field-background: var(--formidable-color-field-background-disabled);
  --formidable-color-field-group-background: var(--formidable-color-field-background-disabled);
  --formidable-color-field-text: var(--formidable-color-field-text-disabled);
  --formidable-color-field-group-text: var(--formidable-color-field-text-disabled);
}

@mixin focused-colors {
  border-color: var(--formidable-color-field-border-focus, #{tokens.$formidable-color-field-border-focus});
  box-shadow: inset 0 0 0 var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness})
    var(--formidable-color-field-border-focus, #{tokens.$formidable-color-field-border-focus});
}

@mixin focused-group-colors {
  border-color: var(--formidable-color-field-group-border-focus, #{tokens.$formidable-color-field-group-border-focus});
  box-shadow: inset 0 0 0
    var(--formidable-field-group-border-thickness, #{tokens.$formidable-field-group-border-thickness})
    var(--formidable-color-field-group-border-focus, #{tokens.$formidable-color-field-group-border-focus});
}

@mixin field-colors {
  @include selection-colors;
  @include placeholder-colors;

  background: var(--formidable-color-field-background, #{tokens.$formidable-color-field-background});
  color: var(--formidable-color-field-text, #{tokens.$formidable-color-field-text});

  &[readonly] {
    @include readonly-colors;
  }

  &[disabled] {
    @include disabled-colors;
  }
}

@mixin field-group-colors {
  background: var(--formidable-color-field-group-background, #{tokens.$formidable-color-field-group-background});
  color: var(--formidable-color-field-group-text, #{tokens.$formidable-color-field-group-text});

  &[readonly] {
    @include readonly-colors;
  }

  &[disabled] {
    @include disabled-colors;
  }
}

@mixin field-font {
  font-size: var(--formidable-field-font-size, #{tokens.$formidable-field-font-size});
  font-weight: var(--formidable-field-font-weight, #{tokens.$formidable-field-font-weight});
  line-height: var(--formidable-field-line-height, #{tokens.$formidable-field-line-height});
}

@mixin field-border {
  border: var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness}) solid
    var(--formidable-color-field-border, #{tokens.$formidable-color-field-border});
  border-radius: var(--formidable-field-border-radius, #{tokens.$formidable-field-border-radius});
}

@mixin field-group-border {
  border: var(--formidable-field-group-border-thickness, #{tokens.$formidable-field-group-border-thickness}) solid
    var(--formidable-color-field-group-border, #{tokens.$formidable-color-field-group-border});
  border-radius: var(--formidable-field-group-border-radius, #{tokens.$formidable-field-group-border-radius});
}

@mixin field {
  @include field-reset;
  @include field-font;
  @include field-colors;
  @include field-border;

  width: 100%;
  position: relative;

  &[disabled] {
    cursor: not-allowed;
    pointer-events: none;
    user-select: none;
  }

  &.is-readonly {
    @include readonly-colors;
  }

  &.is-disabled {
    @include disabled-colors;
  }

  &:focus,
  &.focused,
  &:focus-visible {
    @include focused-colors;
  }
}

@mixin group-field {
  @include field-reset;
  @include field-font;
  @include field-group-colors;
  @include field-group-border;

  &.is-readonly {
    @include readonly-colors;
  }

  &.is-disabled {
    @include disabled-colors;
  }

  &:focus,
  &.focused,
  &:focus-visible {
    @include focused-group-colors;
  }
}

@mixin radio-button-group-field {
  @include group-field;
}

@mixin checkbox-group-field {
  @include group-field;
}

@mixin input-field {
  @include field;

  height: var(--formidable-field-height, #{tokens.$formidable-field-height});
  padding: 0 utils.spacing(16); // horizontal padding only
}

@mixin textarea-field {
  @include input-field;

  min-height: var(--formidable-textarea-min-height, #{tokens.$formidable-textarea-min-height});
  max-height: var(--formidable-textarea-max-height, #{tokens.$formidable-textarea-max-height});
  padding-top: var(--formidable-textarea-padding-top, #{tokens.$formidable-textarea-padding-top});
  resize: vertical;
}

@mixin select-field {
  @include input-field;

  &[disabled] {
    // overwrite user agent styling
    opacity: 1;
  }
}

@mixin panel-field {
  @include select-field;
}

@mixin input-wrapper {
  display: flex;
  align-items: center;
  height: 100%;

  .wrapped-input {
    @include wrapped-input;
  }
}

@mixin dropdown-field {
  @include panel-field;

  .wrapped-input {
    pointer-events: none;
  }
}

@mixin autocomplete-field {
  @include panel-field;
}

@mixin date-field {
  @include panel-field;
}

@mixin time-field {
  @include input-field;
}

@mixin field-before {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  margin-bottom: var(--formidable-field-before-margin-bottom, #{tokens.$formidable-field-before-margin-bottom});
  height: var(--formidable-label-height, #{tokens.$formidable-label-height});
}

@mixin field-label {
  font-size: var(--formidable-label-font-size, #{tokens.$formidable-label-font-size});
  font-weight: var(--formidable-label-font-weight, #{tokens.$formidable-label-font-weight});
  line-height: var(--formidable-label-height, #{tokens.$formidable-label-height});
  height: var(--formidable-label-height, #{tokens.$formidable-label-height});

  color: var(--formidable-color-field-label, #{tokens.$formidable-color-field-label});
  pointer-events: none;
  margin-right: utils.spacing(8);

  // animation
  transform: translateY(0);
  transform-origin: left top;
  transition:
    transform var(--formidable-animation-duration, #{tokens.$formidable-animation-duration})
      var(--formidable-animation-easing, #{tokens.$formidable-animation-easing}),
    margin-right var(--formidable-animation-duration, #{tokens.$formidable-animation-duration})
      var(--formidable-animation-easing, #{tokens.$formidable-animation-easing}),
    font-size var(--formidable-animation-duration, #{tokens.$formidable-animation-duration})
      var(--formidable-animation-easing, #{tokens.$formidable-animation-easing}),
    color var(--formidable-animation-duration, #{tokens.$formidable-animation-duration})
      var(--formidable-animation-easing, #{tokens.$formidable-animation-easing});
}

@mixin field-label-floating {
  font-size: var(--formidable-label-floating-font-size, #{tokens.$formidable-label-floating-font-size});
  font-weight: var(--formidable-label-floating-font-weight, #{tokens.$formidable-label-floating-font-weight});
  line-height: var(--formidable-label-floating-line-height, #{tokens.$formidable-label-floating-line-height});

  position: absolute;
  left: utils.spacing(16);
  margin-right: 0;
  color: var(--formidable-color-field-label-floating, #{tokens.$formidable-color-field-label-floating});
  z-index: 1; // keep on top of field

  // animation
  transform: translateY(var(--formidable-label-floating-offset, #{tokens.$formidable-label-floating-offset})) scale(1);
}

@mixin field-tooltip {
  color: var(--formidable-color-field-tooltip, #{tokens.$formidable-color-field-tooltip});
}

@mixin field-prefix-single {
  position: absolute;
  top: calc(var(--formidable-field-height, #{formidable-field-height}) / 2);
  left: 0;
  padding-left: utils.spacing(16);
  padding-right: utils.spacing(16);
  transform: translateY(-50%);
  color: var(--formidable-color-field-text, #{tokens.$formidable-color-field-text});
  pointer-events: none;
  z-index: 1; // keep on top of field
}

@mixin field-suffix-single {
  position: absolute;
  top: calc(var(--formidable-field-height, #{formidable-field-height}) / 2);
  right: 0;
  padding-left: utils.spacing(16);
  padding-right: utils.spacing(16);
  color: var(--formidable-color-field-text, #{tokens.$formidable-color-field-text});
  transform: translateY(-50%);
  pointer-events: none;
  z-index: 1; // keep on top of field
}

@mixin field-prefix-group {
  padding-bottom: utils.spacing(16);
  color: var(--formidable-color-field-text, #{tokens.$formidable-color-field-text});
}

@mixin field-suffix-group {
  padding-top: utils.spacing(16);
  padding-bottom: utils.spacing(16);
  color: var(--formidable-color-field-text, #{tokens.$formidable-color-field-text});
}

@mixin field-validation-errors {
  margin-top: utils.spacing(8);
  margin-bottom: utils.spacing(16);
}

@mixin field-validation-error {
  font-size: var(--formidable-field-validation-error-font-size, #{tokens.$formidable-field-validation-error-font-size});
  font-weight: var(
    --formidable-field-validation-error-font-weight,
    #{tokens.$formidable-field-validation-error-font-weight}
  );
  line-height: var(
    --formidable-field-validation-error-line-height,
    #{tokens.$formidable-field-validation-error-line-height}
  );

  display: block;
  color: var(--formidable-color-validation-error, #{tokens.$formidable-color-validation-error});
}

@mixin panel-left-aligned {
  left: calc(var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness}) * -1);
  right: unset;
  width: unset;
}

@mixin panel-right-aligned {
  left: unset;
  right: calc(var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness}) * -1);
  width: unset;
}

@mixin panel-full-aligned {
  @include panel-left-aligned;

  width: calc(100% + 2 * var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness}));
}

@mixin panel() {
  @include panel-full-aligned;

  &.panel-left {
    @include panel-left-aligned;
  }

  &.panel-right {
    @include panel-right-aligned;
  }

  outline: 0;
  position: absolute;
  box-shadow: var(--formidable-panel-box-shadow, #{tokens.$formidable-panel-box-shadow});
  border: var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness}) solid
    var(--formidable-color-field-border, #{tokens.$formidable-color-field-border});
  border-radius: var(--formidable-field-border-radius, #{tokens.$formidable-field-border-radius});
  background: var(--formidable-panel-background, #{tokens.$formidable-panel-background});
  overflow: hidden; // clip inner content to border-radius
  z-index: var(--formidable-flyout-z-index, #{tokens.$formidable-flyout-z-index}); // keep on top of field

  // scroll
  display: flex;
  flex-direction: column;
  max-height: var(--formidable-panel-max-height, #{tokens.$formidable-panel-max-height});

  top: calc(100% + var(--formidable-field-border-thickness, #{tokens.$formidable-field-border-thickness}));

  visibility: hidden;
  pointer-events: none;
  transform: translateY(calc(utils.spacing(4) * -1));

  transition: transform var(--formidable-animation-duration, #{tokens.$formidable-animation-duration})
    var(--formidable-animation-easing, #{tokens.$formidable-animation-easing});

  &.open {
    visibility: visible;
    pointer-events: auto;
    transform: translateY(0);
  }

  &.above {
    transform: translateY(calc(-100% - var(--formidable-field-height, #{tokens.$formidable-field-height})));
  }
}

@mixin panel-scrollcontainer() {
  flex: 1 1 auto;
  overflow-y: auto;
  max-height: 100%;
}

@mixin dropdown-panel() {
  @include panel();
}

@mixin autocomplete-panel() {
  @include panel();
}

@mixin date-panel() {
  // overwrite panel max height
  --formidable-panel-max-height: 100vh;

  @include panel();
}

@mixin field-option-readonly {
  --formidable-color-option-prefix-outer: var(--formidable-color-option-prefix-outer-readonly);
  --formidable-color-option-prefix-inner: var(--formidable-color-option-prefix-inner-readonly);

  pointer-events: none;

  background: var(
    --formidable-color-field-option-background-readonly,
    #{tokens.$formidable-color-field-option-background-readonly}
  );
}

@mixin field-option-disabled {
  --formidable-color-option-prefix-outer: var(--formidable-color-option-prefix-outer-disabled);
  --formidable-color-option-prefix-inner: var(--formidable-color-option-prefix-inner-disabled);

  pointer-events: none;
  user-select: none;

  background: var(
    --formidable-color-field-option-background-disabled,
    #{tokens.$formidable-color-field-option-background-disabled}
  );
}

@mixin field-option-selected {
  --formidable-color-option-prefix-outer: var(--formidable-color-option-prefix-outer-selected);
  --formidable-color-option-prefix-inner: var(--formidable-color-option-prefix-inner-selected);

  background: var(
    --formidable-color-field-option-background-selected,
    #{tokens.$formidable-color-field-option-background-selected}
  );
}

@mixin field-option-highlighted {
  --formidable-color-option-prefix-outer: var(--formidable-color-option-prefix-outer-highlighted);
  --formidable-color-option-prefix-inner: var(--formidable-color-option-prefix-inner-highlighted);

  background: var(
    --formidable-color-field-option-background-highlighted,
    #{tokens.$formidable-color-field-option-background-highlighted}
  );
}

@mixin field-option-inline {
  cursor: pointer;
  padding: utils.spacing(8) utils.spacing(16);

  &:hover {
    background: var(
      --formidable-color-field-option-background-hovered,
      #{tokens.$formidable-color-field-option-background-hovered}
    );
  }
}

@mixin field-option-radio-group {
  @include field-option-inline;

  display: flex;
  align-items: center;

  padding: utils.spacing(8) utils.spacing(0);
}

@mixin field-option-checkbox-group {
  @include field-option-radio-group;
}

@mixin field-option-prefix {
  display: flex;
  align-items: center;
  padding: utils.spacing(0) utils.spacing(16);
}

@mixin checkbox-group-prefix-outer {
  width: var(--formidable-option-prefix-dimension-outer, #{tokens.$formidable-option-prefix-dimension-outer});
  height: var(--formidable-option-prefix-dimension-outer, #{tokens.$formidable-option-prefix-dimension-outer});
  border: utils.spacing(2) solid
    var(--formidable-color-option-prefix-outer, #{tokens.$formidable-color-option-prefix-outer});
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--formidable-color-option-prefix-background, #{tokens.$formidable-color-option-prefix-background});
}

@mixin checkbox-group-prefix-inner {
  width: var(--formidable-option-prefix-dimension-inner, #{tokens.$formidable-option-prefix-dimension-inner});
  height: var(--formidable-option-prefix-dimension-inner, #{tokens.$formidable-option-prefix-dimension-inner});
  background: var(--formidable-color-option-prefix-inner, #{tokens.$formidable-color-option-prefix-inner});
}

@mixin radio-group-prefix-outer {
  @include checkbox-group-prefix-outer;

  border-radius: 50%;
}

@mixin radio-group-prefix-inner {
  @include checkbox-group-prefix-inner;

  border-radius: 50%;
}

@mixin date-picker-wrapper {
  display: flex;
  justify-content: center;

  margin: utils.spacing(16);
}

@mixin toggle-background {
  position: relative;
  cursor: pointer;

  &::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 120%;
    height: 120%;
    border-radius: var(--formidable-field-border-radius, #{tokens.$formidable-field-border-radius});
  }

  &:hover::before,
  &.open::before {
    opacity: 1;
    background: var(
      --formidable-color-field-option-background-hovered,
      #{tokens.$formidable-color-field-option-background-hovered}
    );
  }
}

@mixin dropdown-toggle {
  cursor: pointer;
  user-select: none;

  width: utils.spacing(32);
  height: utils.spacing(32);

  &.arrow-up {
    top: calc(utils.spacing(2));
    @include icons.css-icon('arrow-up', utils.spacing(10), utils.spacing(2));
  }

  &.arrow-down {
    top: calc(utils.spacing(2) * -1);
    @include icons.css-icon('arrow-down', utils.spacing(10), utils.spacing(2));
  }
}

@mixin length-indicator {
  position: absolute;
  bottom: utils.spacing(8);

  color: var(--formidable-color-length-indicator, #{tokens.$formidable-color-length-indicator});
  pointer-events: none;
  user-select: none;

  font-size: var(--formidable-length-indicator-font-size, #{tokens.$formidable-length-indicator-font-size});
  font-weight: var(--formidable-length-indicator-font-weight, #{tokens.$formidable-length-indicator-font-weight});
  line-height: var(--formidable-length-indicator-line-height, #{tokens.$formidable-length-indicator-line-height});
}
